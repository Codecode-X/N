正在加载 CLIPGlassesLens 模型权重: /root/NP-CLIP/XTrainer/exp/exp5_glasses/weights/v2_COCO/best_clip_lens_9922.pth
正在加载 NegationDetector 模型权重: /root/NP-CLIP/XTrainer/exp/exp5_glasses/weights/best_NegDet_9404_9212.pth
正在加载 NegationDetector 模型权重: /root/NP-CLIP/XTrainer/exp/exp5_glasses/weights/best_NegDet_9404_9212.pth
正在加载CC-Neg数据集 cache: CCNegGtDataset_cache.pt...
Loaded 228246 samples from cache
训练Glasses所有模块
注册梯度监控钩子
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 27.97% 48.56% 56.88%
Select Accuracy: 95.44%
Mean Similarity Difference (Sp-Sn): 7.4154
Ep1/10  Loss: 2.6674               loss_Ip2Tpn: 1.1799               loss_Tpn2Ip: 0.7549               loss_In2Tnp: 8.7350               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 27.85% 48.79% 57.76%
Select Accuracy: 86.04%
Mean Similarity Difference (Sp-Sn): 1.9110
Best model saved at epoch 0 with ACC: 86.03830337524414
Ep2/10  Loss: 2.6280               loss_Ip2Tpn: 1.0354               loss_Tpn2Ip: 0.7537               loss_In2Tnp: 8.7228               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.48% 49.57% 58.27%
Select Accuracy: 90.78%
Mean Similarity Difference (Sp-Sn): 2.8362
Best model saved at epoch 1 with ACC: 90.77620506286621
Ep3/10  Loss: 2.6160               loss_Ip2Tpn: 1.0000               loss_Tpn2Ip: 0.7544               loss_In2Tnp: 8.7096               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.70% 49.45% 58.39%
Select Accuracy: 90.73%
Mean Similarity Difference (Sp-Sn): 2.4183
💔ACC drop from 90.7762 to 90.7258, cur patience_counter add to 1
Ep4/10  Loss: 2.6067               loss_Ip2Tpn: 0.9820               loss_Tpn2Ip: 0.7534               loss_In2Tnp: 8.6913               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.58% 49.75% 58.44%
Select Accuracy: 91.36%
Mean Similarity Difference (Sp-Sn): 2.9271
Best model saved at epoch 3 with ACC: 91.35584235191345
Ep5/10  Loss: 2.6030               loss_Ip2Tpn: 0.9695               loss_Tpn2Ip: 0.7539               loss_In2Tnp: 8.6886               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.60% 49.97% 58.59%
Select Accuracy: 92.39%
Mean Similarity Difference (Sp-Sn): 3.2678
Best model saved at epoch 4 with ACC: 92.38911271095276
Ep6/10  Loss: 2.5963               loss_Ip2Tpn: 0.9602               loss_Tpn2Ip: 0.7540               loss_In2Tnp: 8.6709               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.68% 49.87% 58.69%
Select Accuracy: 92.49%
Mean Similarity Difference (Sp-Sn): 2.9928
Best model saved at epoch 5 with ACC: 92.4899160861969
Ep7/10  Loss: 2.5952               loss_Ip2Tpn: 0.9511               loss_Tpn2Ip: 0.7521               loss_In2Tnp: 8.6778               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.63% 49.92% 58.74%
Select Accuracy: 92.36%
Mean Similarity Difference (Sp-Sn): 3.2654
💔ACC drop from 92.4899 to 92.3639, cur patience_counter add to 1
Ep8/10  Loss: 2.5938               loss_Ip2Tpn: 0.9477               loss_Tpn2Ip: 0.7537               loss_In2Tnp: 8.6740               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.65% 49.90% 58.82%
Select Accuracy: 92.59%
Mean Similarity Difference (Sp-Sn): 3.2671
Best model saved at epoch 7 with ACC: 92.59072542190552
Ep9/10  Loss: 2.5918               loss_Ip2Tpn: 0.9440               loss_Tpn2Ip: 0.7526               loss_In2Tnp: 8.6707               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.65% 49.95% 58.72%
Select Accuracy: 92.57%
Mean Similarity Difference (Sp-Sn): 3.3022
💔ACC drop from 92.5907 to 92.5655, cur patience_counter add to 1
Ep10/10  Loss: 2.5904               loss_Ip2Tpn: 0.9415               loss_Tpn2Ip: 0.7532               loss_In2Tnp: 8.6668               loss_Tpn2In: 0.0000
测试Glasses模型
==================================================
global Retrieval Recall@1,5,10: 28.63% 49.95% 58.72%
Select Accuracy: 92.64%
Mean Similarity Difference (Sp-Sn): 3.3221
Best model saved at epoch 9 with ACC: 92.64112710952759
Training completed. Best validation ACC: 92.6411
==============配置项===============
epochs: 10
batch_size: 64
lr: 0.0001
num_workers: 4
early_stop_patience: 5
device: cuda
dtype: torch.float32
save_path: best_clip_Glasses.pth
pretrain: False
Lens:
  device: cuda
  dtype: torch.float32
  num_heads: 4
  dropout: 0.1
  model_path: /root/NP-CLIP/XTrainer/exp/exp5_glasses/weights/v2_COCO/best_clip_lens_9922.pth
Frame:
  device: cuda
  dtype: torch.float32
  lambda_0: 1
NegationDetector:
  device: cuda
  model_path: /root/NP-CLIP/XTrainer/exp/exp5_glasses/weights/best_NegDet_9404_9212.pth
  neg_thr: 0.5
Mcq:
  batch_size: 64
  num_workers: 4
  num_options: 4
  split: [0.9, 0.1, 0.0]
  train_dataset_path: /root/NP-CLIP/NegBench/data/images/MCQ/COCO_val_mcq_llama3.1_rephrased.csv
  test_dataset_path: /root/NP-CLIP/NegBench/data/images/MCQ/VOC2007_mcq_llama3.1_rephrased.csv
Retrieval:
  batch_size: 64
  num_workers: 4
  split: [0.9, 0.1, 0.0]
  train_dataset_path: /root/NP-CLIP/NegBench/data/images/Retrieval/COCO_val_negated_retrieval_llama3.1_rephrased_affneg_true.csv
  test_dataset_path: /root/NP-CLIP/NegBench/data/images/Retrieval/COCO_val_negated_retrieval_llama3.1_rephrased_affneg_true.csv
RetrievalWithGtNeg:
  batch_size: 64
  num_workers: 4
  split: [0.9, 0.1, 0.0]
  pos_csv_path: /root/NP-CLIP/NegBench/data/images/Retrieval/COCO_val_retrieval.csv
  negpos_csv_path: /root/NP-CLIP/NegBench/data/images/Retrieval/COCO_val_negated_retrieval_llama3.1_rephrased_affneg_true.csv
  dtype: torch.float32
CCNegGtDataset:
  batch_size: 64
  num_workers: 4
  csv_path: /root/NP-CLIP/NegBench/data/ccneg_converted.csv
  negative_image_ft_mapping_path: /root/NP-CLIP/NegBench/data/distractor_image_mapping.pt
  dtype: torch.float32
ClsEvalDataset:
  csv_path: /root/NP-CLIP/NegBench/data/CLS_Imagenet/imagenet_train.csv
  batch_size: 64
  num_workers: 4
neg_thr: -1
===================================
